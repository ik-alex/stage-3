# Messaging system with RabbitMQ/Celery with a python application behind nginx
---

### The procedures on setting up python application with RabbitMQ/Celery behind nginx server

---

1. RabbitMQ and Celery installation

installing RabbitMQ and Celery on your local machine 

  on ubuntu machine
  ```sh
sudo apt-get update
sudo apt-get install rabbitmq-server
sudo systemctl enable rabbitmq-server
sudo systemctl start rabbitmq-server
```

Celery Installation

Install Celery using pip:
```sh
pip install celery
```

2. Install flask
   ```sh
   pip3 install flask
   ```
3. Configure Nginx
   nginx.conf
   
   ```sh
   user www-data;
   worker_processes auto;
   pid /run/nginx.pid;
   include /etc/nginx/modules-enabled/*.conf;

    events {
    worker_connections 1024;
   }

   http {
	 include /etc/nginx/mime.types;
	 default_type application/octet-stream;

	 ##
	 # SSL Settings
	 ##

	 ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3; # Dropping SSLv3, ref: POODLE
	 ssl_prefer_server_ciphers on;

	 ##
	 # Logging Settings
	 ##

	 access_log /var/log/nginx/access.log;
	 error_log /var/log/nginx/error.log;
    
    	sendfile        on;
    	keepalive_timeout  100;

    	server {
        	listen 80;
        	server_name localhost;

        	location / {
        	proxy_pass http://localhost:5000;
        	proxy_set_header Host $host;
        	proxy_set_header X-Real-IP $remote_addr;
        	proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        	proxy_set_header X-Forwarded-Proto $scheme;
    	}
    
    	location /logs {
            	proxy_pass http://localhost:5000/logs;
            	proxy_set_header Host $host;
            	proxy_set_header X-Real-IP $remote_addr;
            	proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            	proxy_set_header X-Forwarded-Proto $scheme;
        }
        
        error_log  /var/log/nginx/error.log;
     }
    } 



  start nginx:
  ```sh
   sudo nginx -s reload
  ```

  4. Expose the application using ngrok
     install ngrok and expose the application on any port
     ```sh
     ngrok http 80
     ```
     ngrok will provide an endpoint for test your application

     Running the application
       1. Spin up RabbitMQ server:
       ```sh
       sudo systemctl start rabbitmq-server
       ```
       2. spin up the Celery worker:
       ```sh
       celery -A celery_worker worker --loglevel=info
       ```
       3. start your python application
       ```sh
       python3 app.py
       ```
now you can access your application from the endpoints using the URL generated by ngrok e.g `https://8f47-50-70-198-43.ngrok-free.app/?talktome=Hello` `https://8f47-50-70-198-43.ngrok-free.app/?sendmail=destiny@destinedcodes.com`
  
